<html py:extends="master.xhtml" py:strip="True">

<head py:block="head" py:strip="True">
    <title py:block="master_title">WorkBox</title>
    <link rel="stylesheet" type="text/css" media="screen" href="/css/index.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="/css/doughnnut-chart.css" />
</head>

<body py:block="body" py:strip="True">

    <div py:if="not request.identity">
        <!-- not authorized user -->
        <section id="welcome">
            <div class="container outer-center">
                <div class="inner-center" style="padding-bottom:50px;">
                    <img src="/images/box.png" />
                    <h1><b>WorkBox</b></h1>
                    <h2>Сервис для настройки, запуска и мониторинга виртуальных рабочих сред</h2>
                </div>
            </div>
        </section>
    </div>

    <div py:if="request.identity">
        <!-- authorized user -->
        <section id="display-name">
            <div class="container">
                <h1><b>${request.identity['user'].display_name}</b>, добро пожаловать в Ваш <b>WorkBox</b></h1>
            </div>
        </section>
        <section id="doughnut-charts">
            <div class="container">
                <div class="col-sm-6 col-sm-offset-3 col-md-4 col-md-offset-0 col-md-push-4" style="padding:0">
                    <div class="doughnut-chart">
                        <p><b>Загрузка сервиса</b></p>
                        <div id="doughnutGauge" class="chart chart-lg"></div>
                    </div>
                </div>
                <div class="col-sm-6 col-md-4 col-md-pull-4" style="padding:0">
                    <div class="doughnut-chart">
                        <p>&nbsp;</p>
                        <p>Ваши виртуальные среды</p>
                        <div id="doughnutChart1" class="chart chart-sm"></div>
                    </div>
                </div>
                <div class="col-sm-6 col-md-4" style="padding:0">
                    <div class="doughnut-chart">
                        <p>&nbsp;</p>
                        <p>Все виртуальные среды</p>
                        <div id="doughnutChart2" class="chart chart-sm"></div>
                    </div>
                </div>
            </div>
        </section>
        <section id="line-chart">
            <div class="container">
                <p>Средняя загрузка сервиса за последние 7 дней (%)</p>
                <canvas id="chart" height="100"></canvas>
            </div>
        </section>
    </div>
</body>

<script src="/js/jquery.drawDoughnutChart.js"></script>
<script src="/js/colorsGenerator.js"></script>
<script src="/js/Chart.min.js"></script>
<script src="/js/drawChart.js"></script>
<script type="text/javascript">
    $(function ($) {
        $('#welcome').css('border-image', gen10colorsBorder());
    });
</script>
<script py:if="request.identity" type="text/javascript">
    $(function ($) {
        $('#doughnutGauge').drawDoughnutGauge(${load_value});

        $('#doughnutChart1').drawDoughnutChart([
            { title: "Запущенные", value: ${my_boxes['started']}, color: "#00C853" },
            { title: "Остановленные", value: ${my_boxes['stopped']}, color: "#f44336" },
            { title: "Созданные", value: ${my_boxes['created']}, color: "#00BCD4" }
        ]);

        $('#doughnutChart2').drawDoughnutChart([
            { title: "Запущенные", value: ${all_boxes['started']}, color: "#00C853" },
            { title: "Остановленные", value: ${all_boxes['stopped']}, color: "#f44336" },
            { title: "Созданные", value: ${all_boxes['created']}, color: "#00BCD4" }
        ]);

        var chart = document.getElementById('chart').getContext('2d');
        var inputData = {
            labels: ${line_chart['labels']},
            data: ${line_chart['data']}
        }
        drawChart(chart, inputData);
    });
</script>

</html>
