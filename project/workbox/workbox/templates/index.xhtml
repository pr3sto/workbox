<html py:extends="master.xhtml" py:strip="True">

<head py:block="head" py:strip="True">
    <title py:block="master_title">WorkBox</title>
    <link rel="stylesheet" type="text/css" media="screen" href="/css/index.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="/css/doughnnut-chart.css" />
</head>

<body py:block="body" py:strip="True">

    <div py:if="not request.identity">
        <!-- not authorized user -->
        <section id="welcome">
            <div class="container outer-center">
                <div class="inner-center" style="padding-bottom:50px;">
                    <img src="/images/box.png" />
                    <h1><b>WorkBox</b></h1>
                    <h2>Сервис для настройки, запуска и мониторинга виртуальных сред</h2>
                </div>
            </div>
        </section>
    </div>

    <div py:if="request.identity">
        <!-- authorized user -->
        <section id="display-name">
            <div class="outer-center">
                <h1 class="inner-center"><b>${request.identity['user'].display_name}</b>, добро пожаловать в Ваш <b>WorkBox</b></h1>
            </div>
        </section>
        <section id="doughnut-charts">
            <div class="container">
                <div class="col-sm-6 col-sm-offset-3 col-md-4 col-md-offset-0 col-md-push-4" style="padding:0">
                    <div class="doughnut-chart">
                        <p><b>Загрузка сервера</b></p>
                        <div id="doughnutGauge" class="chart chart-lg"></div>
                    </div>
                </div>
                <div class="col-sm-6 col-md-4 col-md-pull-4" style="padding:0">
                    <div class="doughnut-chart">
                        <p>&nbsp;</p>
                        <p>Ваши виртуальные среды</p>
                        <div id="doughnutChart1" class="chart chart-sm"></div>
                    </div>
                </div>
                <div class="col-sm-6 col-md-4" style="padding:0">
                    <div class="doughnut-chart">
                        <p>&nbsp;</p>
                        <p>Все виртуальные среды</p>
                        <div id="doughnutChart2" class="chart chart-sm"></div>
                    </div>
                </div>
            </div>
        </section>
        <section id="last-ten-worked">
            <div class="container">
                <!-- no boxes -->
                <div py:if="len(last_ten_worked)==0" id="empty-placeholder">
                    <a href="/box/new/">Создайте свою первую виртуальную среду</a>
                </div>
                <!-- last ten boxes -->
                <div py:if="len(last_ten_worked)!=0">
                    <h1>Последние виртуальные среды, с которыми Вы работали:</h1>
                    <table id="last-worked-table" class="table">
                        <tbody>
                            <py:for each="box in last_ten_worked">
                                <tr>
                                    <td><a href='/box/${box.box_id}/'>#${box.box_id} - ${box.name} (${box.status})</a></td>
                                    <td>Дата создания: ${box.datetime_of_creation.strftime("%Y-%m-%d %H:%M")}</td>
                                    <td>Дата последнего изменения: ${box.datetime_of_modify.strftime("%Y-%m-%d %H:%M")}</td>
                                </tr>
                            </py:for>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </div>
</body>

<script src="/js/jquery.drawDoughnutChart.js"></script>
<script src="/js/colorsGenerator.js"></script>
<script type="text/javascript">
    $(function ($) {
        $('#welcome').css('border-image', gen10colorsBorder());
    });
</script>
<script py:if="request.identity" type="text/javascript">
    $(function ($) {
        $('#doughnutGauge').drawDoughnutGauge(${load_value});

        $('#doughnutChart1').drawDoughnutChart([
            { title: "Запущенные", value: ${my_boxes['started']}, color: "#00C853" },
            { title: "Остановленные", value: ${my_boxes['stopped']}, color: "#f44336" },
            { title: "Созданные", value: ${my_boxes['created']}, color: "#00BCD4" }
        ]);

        $('#doughnutChart2').drawDoughnutChart([
            { title: "Запущенные", value: ${all_boxes['started']}, color: "#00C853" },
            { title: "Остановленные", value: ${all_boxes['stopped']}, color: "#f44336" },
            { title: "Созданные", value: ${all_boxes['created']}, color: "#00BCD4" }
        ]);
    });
</script>

</html>
